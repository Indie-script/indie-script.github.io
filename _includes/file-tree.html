{% comment %}
Improved _includes/file-tree.html
Logic changes:
1. Extracts key sections like "Docs" and "Indicators" from directory structure.
2. Hides README/index.md if they are the only readable files.
3. Flattens indicator folders to act like files.
{% endcomment %}

<div class="file-tree">
  <ul>
    <li>
      <a href="{{ site.baseurl }}/" class="{% if page.url == '/' %}active{% endif %}">Home</a>
    </li>

    {% assign all_pages = site.pages | sort: 'path' %}
    {% assign indicators = all_pages | where_exp: 'item', "item.path contains 'indicators/' and item.path contains 'README'" %}
    {% assign docs = all_pages | where_exp: 'item', "item.path contains 'docs/' and item.path != 'docs/README.md'" %}

    {% assign root_pages = all_pages | where_exp: 'item', "item.path != '404.html' and item.path != 'feed.xml' and item.path contains '/' == false and item.path contains '_' == false" %}
    {% if root_pages.size > 0 %}1
    <li class="section-header">Pages</li>
    {% for page_item in root_pages %}
      <li class="file-item">
        <a href="{{ site.baseurl }}{{ page_item.url }}" class="{% if page.url == page_item.url %}active{% endif %}">
          {{ page_item.path | replace: '.md', '' | replace: '.html', '' }}
        </a>
      </li>
    {% endfor %}
    {% endif %}

    {% if indicators.size > 0 %}
    <li class="section-header">Indicators</li>
    {% for item in indicators %}
      {% assign folder_name = item.path | split: '/' | slice: -2, 1 | first %}
      <li class="file-item">
        <a href="{{ site.baseurl }}{{ item.url }}" class="{% if page.url == item.url %}active{% endif %}">
          {{ folder_name | replace: '-', ' ' }}
        </a>
      </li>
    {% endfor %}
    {% endif %}

    {% assign doc_readme = all_pages | where: 'path', 'docs/README.md' | first %}
    {% if doc_readme or docs.size > 0 %}
    <li class="section-header">Docs</li>
    <li class="directory">
      <details {% if page.path contains 'docs/' %}open{% endif %}>
        <summary>
          <div class="directory-container">
            <span class="directory-item">docs</span>
            <span class="toggle-btn" onclick="event.preventDefault(); toggleDetailsClick(this)">â–¼</span>
          </div>
        </summary>
        <ul>
          {% if doc_readme %}
          <li class="file-item">
            <a href="{{ site.baseurl }}{{ doc_readme.url }}" class="{% if page.url == doc_readme.url %}active{% endif %}">
              README
            </a>
          </li>
          {% endif %}
          {% for page_item in docs %}
          <li class="file-item">
            <a href="{{ site.baseurl }}{{ page_item.url }}" class="{% if page.url == page_item.url %}active{% endif %}">
              {{ page_item.path | split: '/' | last | replace: '.md', '' | replace: '.html', '' }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </details>
    </li>
    {% endif %}

  </ul>
</div>
