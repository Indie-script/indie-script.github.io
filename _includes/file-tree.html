<!-- _includes/file-tree.html -->
<div class="file-tree">
    <ul>
      <!-- Home link -->
      <li>
        <a href="{{ site.baseurl }}/" class="{% if page.url == '/' %}active{% endif %}">Home</a>
      </li>
      
      <!-- Show all pages sorted -->
      {% assign sorted_pages = site.pages | sort: "path" %}
      
      <!-- Files not in directories -->
      {% for page_item in sorted_pages %}
        {% assign parts = page_item.path | split: "/" %}
        {% if parts.size == 1 %}
          {% unless page_item.path contains '_' or page_item.path == '404.html' or page_item.path == 'feed.xml' %}
            <li class="file-item">
              <a href="{{ site.baseurl }}{{ page_item.url }}" class="{% if page.url == page_item.url %}active{% endif %}">
                {{ page_item.title | default: page_item.path | split: "." | first }}
              </a>
            </li>
          {% endunless %}
        {% endif %}
      {% endfor %}
      
      <!-- Extract all top-level directories -->
      {% assign top_dirs = "" | split: "" %}
      {% for page_item in sorted_pages %}
        {% assign parts = page_item.path | split: "/" %}
        {% if parts.size > 1 %}
          {% assign dir = parts[0] %}
          {% unless top_dirs contains dir or dir contains '_' %}
            {% assign top_dirs = top_dirs | push: dir %}
          {% endunless %}
        {% endif %}
      {% endfor %}
      
      <!-- Display directories and their files -->
      {% for dir in top_dirs %}
        <li class="directory">
          <details>
            <summary>
              <span class="directory-item">{{ dir }}</span>
            </summary>
            <ul>
              {% for page_item in sorted_pages %}
                {% if page_item.path contains dir %}
                  {% assign parts = page_item.path | split: "/" %}
                  {% if parts.size == 2 %}
                    <li class="file-item">
                      <a href="{{ site.baseurl }}{{ page_item.url }}" class="{% if page.url == page_item.url %}active{% endif %}">
                        {{ page_item.title | default: parts[1] | split: "." | first }}
                      </a>
                    </li>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </ul>
          </details>
        </li>
      {% endfor %}
    </ul>
  </div>